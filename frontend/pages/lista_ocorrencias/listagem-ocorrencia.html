<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>PI-FIRE | Listagem de Ocorr√™ncias</title>
    
    <link rel="stylesheet" href="./listagem-ocorrencia-styles.css"/> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    
    <header class="topbar">
        <button class="menu-toggle" aria-label="Abrir menu" onclick="window.location.href='home.html'"> 
            <i class="fas fa-bars"></i>
        </button>

        <h1>Listagem de Ocorr√™ncias</h1>

        <div class="usuario">
            <i class="fas fa-user-circle"></i>
            <span id="usuario-logado">Usu√°rio</span>
        </div>
    </header>

    <main class="layout">
        
        <a href="criar-ocorrencia.html" class="fab-button" title="Registrar Nova Ocorr√™ncia">
            <i class="fas fa-plus"></i>
        </a>
        
        <aside class="filtros">
            <h3>Filtros R√°pidos</h3>
            <button class="chip">Data</button>
            <button class="chip">Hor√°rio</button>
            <button class="chip">Tipo</button>
            <button class="chip">Regi√£o</button>
            <button class="chip">Status</button>
        </aside>

        <section class="lista">
            <h2 class="titulo-lista">Todas as Ocorr√™ncias</h2>

            <ul id="lista-ocorrencias" class="ocorrencias">
                <li class="loading-message">Carregando ocorr√™ncias...</li>
            </ul>
        </section>
    </main>

    <script type="module">
    // =========================================================
    // üí° L√ìGICA DE RENDERIZA√á√ÉO E MOCKS (Atualizada com Data)
    // =========================================================
    
    let listaOcorrencias = []; 
    const listaElement = document.getElementById("lista-ocorrencias");

    // MOCK de dados com 'data' e 'registradoPor'
    const mock = [
        // Adicionando a data no formato "DD/MM" (ou o que for mais relevante para o seu PWA)
        { id: 101, titulo: "Inc√™ndio em S√£o Jos√©", detalhe: "Pr√≥x ao galp√£o 02 do cais", data: "20/10", hora: "14:38", tipo: "Inc√™ndio", registradoPor: "Sgt. Silva" },
        { id: 102, titulo: "Acidente em Get√∫lio Vargas", detalhe: "Em frente √† faculdade", data: "19/10", hora: "13:12", tipo: "Resgate", registradoPor: "Cb. Mendes" },
        { id: 103, titulo: "Rua do Cariri√±os", detalhe: "Cabo preso a √°rvore", data: "18/10", hora: "10:12", tipo: "Preven√ß√£o", registradoPor: "Ten. Costa" },
    ];
    listaOcorrencias = mock; 


    // L√≥gica de manipula√ß√£o dos bot√µes
    function handleEdit(id) {
        alert(`EDITAR OCORR√äNCIA: ID ${id}\nRedirecionando...`);
    }

    async function handleDelete(id) {
        if (!confirm(`Tem certeza que deseja DELETAR a ocorr√™ncia ID ${id}?`)) {
            return;
        }
        listaOcorrencias = listaOcorrencias.filter(o => o.id !== id);
        renderizarLista();
    }
    
    // Expondo as fun√ß√µes globalmente para o onclick
    window.handleEdit = handleEdit;
    window.handleDelete = handleDelete;


    // Renderiza√ß√£o de um √∫nico item com data e hora
    // ‚ö†Ô∏è ATUALIZA√á√ÉO: Recebendo 'data' e combinando-a com a 'hora'
    function criaItem({ id, titulo, detalhe, data, hora, tipo, registradoPor }) {
        const iconSvg = `
          <svg width="26" height="26" viewBox="0 0 24 24" fill="white" aria-hidden="true">
            <path d="M13 3s-1 2-3 3c0 0 2-1 3-1 0 0-4 3-4 7a5 5 0 1 0 10 0c0-3-2-5-2-5s.5 2.5-1 4c0 0 .5-2.5-1-5-.5-1-1-2-1-3z"/>
          </svg>`;

        const li = document.createElement("li");
        li.className = "item";
        li.setAttribute('data-id', id);

        // Combina Data e Hora
        const dataEHora = `${data || 'N/A'} - ${hora || 'N/A'}`;

        li.innerHTML = `
            <div class="icone">${iconSvg}</div>
            <div class="texto">
                <div class="linha1">
                    <strong class="titulo">${titulo}</strong>
                    <span class="hora">${dataEHora}</span> 
                </div>
                <div class="linha2">
                    <span class="detalhe">${detalhe || ""}</span>
                    <span class="badge">${tipo}</span>
                </div>
                <div class="linha3">
                    <span class="registrado-por">Registrado por: <strong>${registradoPor || 'N/A'}</strong></span>
                </div>
            </div>
            <div class="acoes">
                <button class="botao-editar" onclick="handleEdit(${id})" title="Editar Ocorr√™ncia">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83l3.75 3.75l1.83-1.83z"/></svg>
                </button>
                <button class="botao-deletar" onclick="handleDelete(${id})" title="Deletar Ocorr√™ncia">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12l1.41 1.41L13.41 14l2.12 2.12l-1.41 1.41L12 15.41l-2.12 2.12l-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                </button>
            </div>
        `;
        return li;
    }

    // Fun√ß√£o principal de renderiza√ß√£o (mantida)
    function renderizarLista() {
        listaElement.innerHTML = '';
        
        if (listaOcorrencias.length === 0) {
            listaElement.innerHTML = '<li class="empty-message">Nenhuma ocorr√™ncia encontrada.</li>';
            return;
        }
        
        listaOcorrencias.forEach(o => listaElement.appendChild(criaItem(o)));
    }

    // Inicializa
    document.addEventListener('DOMContentLoaded', renderizarLista);
    
    const u = localStorage.getItem("usuarioEmail");
    if (u) {
        document.getElementById("usuario-logado").textContent = u;
    }
</script>
</body>
</html>